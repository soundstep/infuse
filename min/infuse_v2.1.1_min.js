/* infuse.js - v2.1.1 - 2019-01-14 - https://github.com/soundstep/infuse.js - http://www.soundstep.com */
!function(h){"use strict";h.version="2.1.1";var u=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,I=/(?!function)\s*constructor\s*[^\(|function]*\(\s*([^\)]*)\)\s*{/m,E=/,/,l=/^\s*(_?)(\S+?)\1\s*$/,f=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;h.errors={MAPPING_BAD_PROP:"[Error Injector.MAPPING_BAD_PROP] The first parameter is invalid, a string is expected.",MAPPING_BAD_VALUE:"[Error Injector.MAPPING_BAD_VALUE] The second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error Injector.MAPPING_BAD_CLASS] The second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error Injector.MAPPING_BAD_SINGLETON] The third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error Injector.MAPPING_ALREADY_EXISTS] This mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error Injector.CREATE_INSTANCE_INVALID_PARAM] Invalid parameter, a function is expected.",NO_MAPPING_FOUND:"[Error Injector.NO_MAPPING_FOUND] No mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error Injector.INJECT_INSTANCE_IN_ITSELF_PROPERTY] A matching property has been found in the target, you can't inject an instance in itself.",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error Injector.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR] A matching constructor parameter has been found in the target, you can't inject an instance in itself.",DEPENDENCIES_MISSING_IN_STRICT_MODE:'[Error Injector.DEPENDENCIES_MISSING_IN_STRICT_MODE] An "inject" property (array) that describes the dependencies is missing in strict mode.',DEPENDENCIES_MISSING_IN_STRICT_MODE_CONSTRUCTOR_INJECTION:'[Error Injector.DEPENDENCIES_MISSING_IN_STRICT_MODE_CONSTRUCTOR_INJECTION] An "inject" property (array) that describes the dependencies of constructor is missing in strict mode.',DEPENDENCIES_INVALID_TARGET:"[Error Injector.DEPENDENCIES_INVALID_TARGET] Invalid target, a function or a class is expected (arrow function cannot be instantiated)."};var e=function(t,r,n,e){this.prop=t,this.value=r,this.cl=n,this.singleton=e||!1},i=function(t){if("string"!=typeof t)throw new Error(h.errors.MAPPING_BAD_PROP)},o=function(t,r){if(function(t,r){for(var n=t.length;n--;)if(t[n]===r)return!0;return!1}(h.getDependencies(r),t))throw new Error(h.errors.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},p=function(t,r){var n=void 0!==t?' for the injection name: "'+t+'"':"",e=void 0!==r?' when instantiating: "'+r+'"':"";return h.errors.NO_MAPPING_FOUND+n+e+"."};h.Injector=function(){this.mappings={},this.parent=null,this.strictMode=!1,this.strictModeConstructorInjection=!1,this.throwOnMissing=!0},h.getDependencies=function(t){var r,e=[];function n(t,r,n){e.push(n)}t.hasOwnProperty("inject")&&"[object Array]"===Object.prototype.toString.call(t.inject)&&0<t.inject.length&&(r=t.inject);var i,o=t.toString().replace(f,"");if(0===o.indexOf("class"))i=o.replace(/function constructor/g,"").match(I);else{if(0!==o.indexOf("function"))throw new Error(h.errors.DEPENDENCIES_INVALID_TARGET);i=o.match(u)}if(i)for(var s=i[1].split(E),a=0,p=s.length;a<p;a++){var c=s[a].split("=")[0].replace(/\s/g,"");(r&&r[a]?r[a]:c).replace(l,n)}return e},h.Injector.prototype={createChild:function(){var t=new h.Injector;return t.parent=this,t.strictMode=this.strictMode,t.strictModeConstructorInjection=this.strictModeConstructorInjection,t.throwOnMissing=this.throwOnMissing,t},getMappingVo:function(t){return this.mappings?this.mappings[t]?this.mappings[t]:this.parent?this.parent.getMappingVo(t):null:null},mapValue:function(t,r){if(this.mappings[t])throw new Error(h.errors.MAPPING_ALREADY_EXISTS+t);return i(t),function(t,r){if(null==r)throw new Error(h.errors.MAPPING_BAD_VALUE+t)}(t,r),this.mappings[t]=new e(t,r,void 0,void 0),this},mapClass:function(t,r,n){if(this.mappings[t])throw new Error(h.errors.MAPPING_ALREADY_EXISTS+t);return i(t),function(t,r){if("function"!=typeof r)throw new Error(h.errors.MAPPING_BAD_CLASS+t)}(t,r),n&&function(t,r){if("boolean"!=typeof r)throw new Error(h.errors.MAPPING_BAD_SINGLETON+t)}(t,n),this.mappings[t]=new e(t,null,r,n),this},removeMapping:function(t){return this.mappings[t]=null,delete this.mappings[t],this},hasMapping:function(t){return!!this.mappings[t]},hasInheritedMapping:function(t){return!!this.getMappingVo(t)},getMapping:function(t){for(var r in this.mappings)if(this.mappings.hasOwnProperty(r)){var n=this.mappings[r];if(n.value===t||n.cl===t)return n.prop}},getValue:function(t){var r=this.mappings[t];if(!r){if(!this.parent){if(this.throwOnMissing)throw new Error(p(t));return}r=this.parent.getMappingVo.apply(this.parent,arguments)}if(r.cl){var n=Array.prototype.slice.call(arguments);return n[0]=r.cl,r.singleton?(r.value||(r.value=this.createInstance.apply(this,n)),r.value):this.createInstance.apply(this,n)}return r.value},getClass:function(t){var r=this.mappings[t];if(!r){if(!this.parent)return;r=this.parent.getMappingVo.apply(this.parent,arguments)}if(r.cl)return r.cl},instantiate:function(t){if("function"!=typeof t)throw new Error(h.errors.CREATE_INSTANCE_INVALID_PARAM);var r=h.getDependencies(t);if(this.strictMode&&!t.hasOwnProperty("inject"))throw new Error(h.errors.DEPENDENCIES_MISSING_IN_STRICT_MODE);if(this.strictModeConstructorInjection&&0<r.length&&!t.hasOwnProperty("inject"))throw new Error(h.errors.DEPENDENCIES_MISSING_IN_STRICT_MODE_CONSTRUCTOR_INJECTION);for(var n=[null],e=0,i=r.length;e<i;e++)if(arguments.length>e+1&&void 0!==arguments[e+1]&&null!==arguments[e+1])n.push(arguments[e+1]);else{var o=r[e],s=this.getMappingVo(o);if(s){var a=this.getInjectedValue(s,o);n.push(a)}else{if(this.throwOnMissing)throw new Error(p(o,t.name));n.push(void 0)}}return new(Function.prototype.bind.apply(t,n))},inject:function(t,r){for(var n in this.parent&&this.parent.inject(t,!0),this.mappings)if(this.mappings.hasOwnProperty(n)){var e=this.getMappingVo(n);(t.hasOwnProperty(e.prop)||t.constructor&&t.constructor.prototype&&t.constructor.prototype.hasOwnProperty(e.prop))&&(t[n]=this.getInjectedValue(e,n))}return"function"!=typeof t.postConstruct||r||t.postConstruct(),this},getInjectedValue:function(t,r){var n,e=t.value;return t.cl&&(t.singleton?(t.value||(o(r,t.cl),t.value=this.instantiate(t.cl),n=t.value),e=t.value):(o(r,t.cl),n=e=this.instantiate(t.cl))),n&&(!function(t,r){if(r.hasOwnProperty(t))throw new Error(h.errors.INJECT_INSTANCE_IN_ITSELF_PROPERTY)}(r,n),this.inject(n)),e},createInstance:function(){var t=this.instantiate.apply(this,arguments);return this.inject(t),t},getValueFromClass:function(t){for(var r in this.mappings)if(this.mappings.hasOwnProperty(r)){var n=this.mappings[r];if(n.cl===t)return n.singleton?(n.value||(n.value=this.createInstance.apply(this,arguments)),n.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);if(this.throwOnMissing)throw new Error(p(void 0,t.name))},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(e){var i=this;if("function"!=typeof i)throw new Error("Error, you must bind a function.");var o=Array.prototype.slice.call(arguments,1),s=function(){if(this instanceof s){var t=function(){};t.prototype=i.prototype;var r=new t,n=i.apply(r,o.concat(Array.prototype.slice.call(arguments)));return Object(n)===n?n:r}return i.apply(e,o.concat(Array.prototype.slice.call(arguments)))};return s}),"function"==typeof define&&void 0!==define.amd&&define("infuse",h),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=h),"undefined"!=typeof exports&&(exports=h)}(this.infuse=this.infuse||{});